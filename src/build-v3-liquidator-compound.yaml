categories: []
content: How to build Liquidator for the new version of Compound
created: '2023-03-14T13:04:22.402Z'
guideIntegrations:
  discordRoleIds: []
guideType: course
key: build-v3-liquidator-compound
name: Build V3 Liquidator
publishStatus: Live
showIncorrectOnCompletion: true
steps:
  - content: >-
      ## Changes to the liquidation system in Compound III

      The latest version of the Compound protocol has undergone changes in its
      liquidation system. To ensure the system's solvency, the protocol takes
      over borrower accounts that violate the collateral requirements.
      Underwater borrowers are repaid using the protocol's reserves. However, if
      the protocol reserves fall below a governance-selected threshold, anyone
      can extract value after the account is absorbed.


      ## Liquidation criteria in Compound III

      Like other DeFi projects, Compound III demands that borrowers maintain a
      greater value of collateral locked in the protocol than the total value of
      their borrow at all times, a process called over-collateralization. When a
      borrower accrues excessive interest on their borrow, or the USD value of
      their collateral decreases too much, or the USD value of their borrow
      rises too much, the account becomes liquidatable.


      ## Incentives for liquidators in Compound III

      During the liquidation process, any account can extract value through an
      arbitrage opportunity. When the protocol absorbs an account, it repays its
      open borrow of the base asset using the protocol reserves and seizes the
      entire collateral assets of the account. Using the protocol's price feed,
      the seized collateral's discounted price is determined and then publicly
      sold. Any account can purchase the discounted collateral using the base
      asset. A liquidator can purchase the discounted collateral asset, trade it
      on a DEX at a higher price, and earn the difference in a single EVM
      transaction.
    name: Introduction
    stepItems: []
    uuid: 90c244a7-4594-4935-ae57-cfce23c24be8
  - content: >-
      This is an example of how Compound III handles liquidations


      1. If a borrower doesn't have enough collateral to cover their loan or the
      value of their collateral drops too much, their account can be liquidated.
      This can be checked at any time programmatically using the Comet
      `isLiquidatable` function, which returns a boolean.


      2. A person who notices the liquidation creates a transaction to make
      money through arbitrage.


      3. The first step in the process is for the protocol to move the
      borrower's collateral to the protocol balance sheet to cover the loan.
      This is done by invoking the `absorb` function on the Comet smart
      contract. 


      4. The absorb function guarantees that the current reserves value is lower
      than targetReserves. Once targetReserves is achieved, the v3 contracts
      retain the collateral assets and provide compensation to the liquidator
      through rewards. However, reaching the high value of targetReserves is
      unlikely.


      4. The person then figures out how much of the borrower's collateral they
      can buy with the base asset. To ascertain the payment for the base asset,
      the searcher should inspect the `collateralBalanceOf` for each associated
      collateral asset. After obtaining the asset's price through the price
      feed, they can utilize the `quoteCollateral` function to determine the
      discounted rate.


      5. They can pay for this with their own money or by using another protocol
      to borrow the base asset. This can be done by calling `buyCollateral` to
      purchase as much of the discounted collateral as they can.


      6. Once they have the collateral, they can sell it at a higher price on a
      DEX like Uniswap.


      7. They use the profits to repay any borrowed base asset and keep the
      remaining balance for themselves.
    name: Liquidation Process
    stepItems: []
    uuid: 07ea4ffb-c587-4446-b3a3-53bd57f3ed0b
  - content: >+
      The process of a Compound III liquidation is as follows. A protocol price
      feed update or an interest accrual occurs that renders a borrower account
      underwater. A searcher detects this change and creates an EVM transaction
      that executes the liquidation and captures value through arbitrage. The
      searcher calls the Comet absorb function, which moves the borrower's
      collateral to the protocol balance sheet and reduces reserves to cover the
      entire borrow. The searcher then determines the amount of the base asset
      that can be exchanged for the seized collateral by checking the
      collateralBalanceOf the Comet contract address for each collateral asset,
      getting its price using the price feed, and using the quoteCollateral
      function to find the discounted rate. The searcher can pay the base asset
      out of their pocket or open a flash loan using another protocol. The
      searcher then calls buyCollateral to purchase as much of the discounted
      collateral as possible. Once the searcher holds the discounted collateral,
      they can sell it at market price using a DEX like Uniswap. The searcher
      repays the flashswap and sends the remaining balance of the base asset in
      their account to their hot wallet or contract.

    name: Example Liquidation Scenario
    stepItems: []
    uuid: a7cbb86b-5c61-4c55-af12-e70efd6d3335
  - content: >-
      Liquidations can occur on any blockchain where Compound III is deployed,
      and the protocol is written in Solidity and can be deployed to any EVM
      chain that has a price feed, sufficient liquidity, and a means for
      on-chain governance. However, running the liquidator bot contract example
      in the Comet repository is not recommended as it only serves as an
      educational tool, and running it may result in reverted transactions and
      EVM gas wasted as a result of losing the battle to better running
      searchers.
    name: Blockchains for Liquidation
    stepItems: []
    uuid: 9158616f-321a-4bf0-ba8c-1127daf16fdb
thumbnail: https://d31h13bdjwgzxs.cloudfront.net/academy/compound/compound_liquidator.png
uuid: build-v3-liquidator-compound
